<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ตลาดผักออนไลน์ (ตัวอย่าง)</title>
  <style>
    :root{
      --accent:#16a34a;
      --muted:#666;
      --bg:#f6fbf6;
      --card:#fff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:#0f172a}
    header{background:var(--card);padding:18px 20px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 1px 6px rgba(2,6,23,0.06)}
    .brand{display:flex;gap:12px;align-items:center}
    h1{font-size:18px;margin:0}
    main{padding:20px;max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr 360px;gap:20px}
    .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 16px rgba(2,6,23,0.04);display:flex;flex-direction:column;gap:8px}
    .card img{width:100%;height:140px;object-fit:cover;border-radius:8px}
    .price{color:var(--accent);font-weight:700}
    button{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    aside{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 16px rgba(2,6,23,0.04)}
    .cart-item{display:flex;gap:10px;align-items:center;padding:8px 0;border-bottom:1px solid #eef6ee}
    .cart-item img{width:56px;height:56px;object-fit:cover;border-radius:8px}
    .qty{display:flex;gap:6px;align-items:center}
    .qty button{background:#e8f4ea;color:var(--accent);border:0;padding:6px;border-radius:6px;cursor:pointer}
    .total{display:flex;justify-content:space-between;padding:12px 0;font-weight:700}
    footer{text-align:center;padding:16px;color:var(--muted)}
    .searchbar{display:flex;gap:8px;align-items:center}
    input[type=text]{padding:8px 12px;border-radius:8px;border:1px solid #e6eee6;width:260px}
    select{padding:8px;border-radius:8px;border:1px solid #e6eee6}
    @media(max-width:920px){main{grid-template-columns:1fr} aside{order:2;margin-top:12px}}
    /* modal */
    .modal{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center;visibility:hidden;opacity:0;transition:all .18s}
    .modal.open{visibility:visible;opacity:1}
    .dialog{background:var(--card);padding:16px;border-radius:10px;width:480px;max-width:94%}
    .field{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
    input[type=text].short,input[type=email]{padding:8px;border-radius:6px;border:1px solid #e6eee6}
    small{color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="var(--accent)"/><path d="M7 12h10M7 8h10M7 16h10" stroke="#fff" stroke-width="1.3" stroke-linecap="round"/></svg>
      <div>
        <h1>ตลาดผักออนไลน์ (Demo)</h1>
        <small style="color:var(--muted)">ผักสดจากฟาร์ม — ทดลองสั่งซื้อได้</small>
      </div>
    </div>

    <div class="searchbar">
      <input id="search" type="text" placeholder="ค้นหาผัก เช่น ผักกาด ใส่กรอก" />
      <select id="category">
        <option value="all">ทุกหมวด</option>
      </select>
      <button id="btn-view-cart">ตะกร้า (<span id="count">0</span>)</button>
    </div>
  </header>

  <main>
    <section>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h2 style="margin:0">สินค้า</h2>
        <div style="color:var(--muted)">แสดง <span id="shown">0</span> รายการ</div>
      </div>

      <div class="products" id="products"></div>
    </section>

    <aside>
      <h3 style="margin-top:0">ตะกร้าของคุณ</h3>
      <div id="cart-list"></div>
      <div class="total">
        <div>รวม</div>
        <div id="cart-total">0 ฿</div>
      </div>
      <button id="checkout">ไปชำระเงิน</button>
    </aside>
  </main>

  <footer>ตัวอย่างหน้าเว็บ — เก็บข้อมูลบนเครื่องด้วย localStorage</footer>

  <!-- modal checkout -->
  <div id="modal" class="modal">
    <div class="dialog">
      <h3>แบบฟอร์มสั่งซื้อ</h3>
      <div class="field">
        <label>ชื่อ-นามสกุล</label>
        <input id="fullname" class="short" type="text" placeholder="เช่น สมชาย ใจดี" />
      </div>
      <div class="field">
        <label>อีเมล</label>
        <input id="email" type="email" placeholder="example@mail.com" />
      </div>
      <div class="field">
        <label>ที่อยู่จัดส่ง</label>
        <input id="address" type="text" placeholder="เลขที่/ซอย/จังหวัด" />
      </div>
      <div style="display:flex;justify-content:flex-end;gap:8px">
        <button id="cancel">ยกเลิก</button>
        <button id="confirm" style="background:var(--accent);color:#fff">ยืนยันการสั่งซื้อ</button>
      </div>
    </div>
  </div>

  <script>
    // ตัวอย่างสินค้า (ผัก)
    const PRODUCTS = [
      {id:1,title:'ผักกาดขาว (1 กก.)',price:45,cat:'ผักใบ',img:'https://gourmetmarketthailand.com/_next/image?url=https%3A%2F%2Fmedia-stark.gourmetmarketthailand.com%2Fproducts%2Fcover%2F60927-1-1749621617.587.webp&w=1200&q=75'},
      {id:2,title:'คะน้าฮ่องกง (1 กก.)',price:50,cat:'ผักใบ',img:'https://gourmetmarketthailand.com/_next/image?url=https%3A%2F%2Fmedia-stark.gourmetmarketthailand.com%2Fproducts%2Fcover%2F70376-1.webp&w=1200&q=75'},
      {id:3,title:'มะเขือเทศ (500 g)',price:65,cat:'ผลไม้ผัก',img:'https://medthai.com/wp-content/uploads/2013/07/Tomato-1.jpg'},
      {id:4,title:'พริกขี้หนู (100 g)',price:30,cat:'เครื่องเทศ',img:'https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=800&q=60&auto=format&fit=crop'},
      {id:5,title:'ผักชี (1 แพ็ค)',price:15,cat:'ผักใบ',img:'https://images.unsplash.com/photo-1544025162-d76694265947?w=800&q=60&auto=format&fit=crop'},
      {id:6,title:'หัวหอม (1 กก.)',price:55,cat:'หัว/ราก',img:'https://images.unsplash.com/photo-1589308078053-3f2a1bd6c7f0?w=800&q=60&auto=format&fit=crop'}
    ];

    // DOM
    const productsEl = document.getElementById('products');
    const cartListEl = document.getElementById('cart-list');
    const cartTotalEl = document.getElementById('cart-total');
    const countEl = document.getElementById('count');
    const shownEl = document.getElementById('shown');
    const searchEl = document.getElementById('search');
    const categoryEl = document.getElementById('category');
    const modal = document.getElementById('modal');

    // cart stored as {productId: qty}
    let cart = JSON.parse(localStorage.getItem('veg_cart_v1')||'{}');

    function saveCart(){ localStorage.setItem('veg_cart_v1', JSON.stringify(cart)); }

    function renderCategories(){
      const cats = ['all', ...new Set(PRODUCTS.map(p=>p.cat))];
      categoryEl.innerHTML = '';
      cats.forEach(c=>{
        const opt = document.createElement('option'); opt.value=c; opt.textContent = c==='all' ? 'ทุกหมวด' : c;
        categoryEl.appendChild(opt);
      });
    }

    function renderProducts(q=''){
      const text = (q || '').trim().toLowerCase();
      const filtered = PRODUCTS.filter(p=>{
        const inCat = categoryEl.value==='all' || p.cat === categoryEl.value;
        const match = p.title.toLowerCase().includes(text) || p.cat.toLowerCase().includes(text);
        return inCat && match;
      });
      productsEl.innerHTML = '';
      filtered.forEach(p=>{
        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `
          <img src="${p.img}" alt="${p.title}" />
          <div style="flex:1">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:700">${p.title}</div>
              <div class="price">${p.price} ฿</div>
            </div>
            <div style="color:var(--muted);font-size:13px;margin-top:6px">หมวด: ${p.cat}</div>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
            <button onclick="addToCart(${p.id})">เพิ่มลงตะกร้า</button>
          </div>
        `;
        productsEl.appendChild(card);
      });
      shownEl.textContent = filtered.length;
    }

    function renderCart(){
      cartListEl.innerHTML = '';
      let total = 0; let count = 0;
      Object.keys(cart).forEach(id=>{
        const qty = cart[id];
        const p = PRODUCTS.find(x=>x.id==id);
        if(!p) return;
        count += qty;
        const el = document.createElement('div'); el.className='cart-item';
        el.innerHTML = `
          <img src="${p.img}" alt="${p.title}" />
          <div style="flex:1">
            <div style="font-weight:600">${p.title}</div>
            <div style="color:var(--muted)">${p.price} ฿ x ${qty} = ${p.price*qty} ฿</div>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
            <div class="qty">
              <button onclick="updateQty(${p.id},-1)">-</button>
              <div style="padding:4px 8px;border-radius:6px;border:1px solid #e6f3e8">${qty}</div>
              <button onclick="updateQty(${p.id},1)">+</button>
            </div>
            <button onclick="removeFromCart(${p.id})" style="background:transparent;color:#ef4444;border:0;padding:4px">ลบ</button>
          </div>
        `;
        cartListEl.appendChild(el);
        total += p.price*qty;
      });
      cartTotalEl.textContent = total.toLocaleString('th-TH') + ' ฿';
      countEl.textContent = count;
    }

    function addToCart(id){
      cart[id] = (cart[id]||0) + 1;
      saveCart(); renderCart();
    }
    function updateQty(id,delta){
      cart[id] = Math.max(0,(cart[id]||0)+delta);
      if(cart[id]===0) delete cart[id];
      saveCart(); renderCart();
    }
    function removeFromCart(id){
      delete cart[id]; saveCart(); renderCart();
    }

    // checkout flow (local)
    document.getElementById('checkout').addEventListener('click',()=>{
      if(Object.keys(cart).length === 0){ alert('ตะกร้าว่าง!'); return; }
      modal.classList.add('open');
    });
    document.getElementById('cancel').addEventListener('click',()=> modal.classList.remove('open'));
    document.getElementById('confirm').addEventListener('click',()=>{
      const fullname = document.getElementById('fullname').value.trim();
      const email = document.getElementById('email').value.trim();
      const address = document.getElementById('address').value.trim();
      if(!fullname || !email || !address){ alert('กรุณากรอกข้อมูลให้ครบ'); return; }
      const order = { id: 'ORD'+Date.now(), date:new Date().toISOString(), customer:{fullname,email,address}, items:cart };
      const orders = JSON.parse(localStorage.getItem('veg_orders_v1')||'[]');
      orders.push(order); localStorage.setItem('veg_orders_v1', JSON.stringify(orders));
      cart = {}; saveCart(); renderCart(); modal.classList.remove('open');
      alert('สั่งซื้อเรียบร้อย! หมายเลขคำสั่งซื้อ: ' + order.id);
      // Clear form
      document.getElementById('fullname').value=''; document.getElementById('email').value=''; document.getElementById('address').value='';
    });

    // search/filter
    searchEl.addEventListener('input', ()=> renderProducts(searchEl.value));
    categoryEl.addEventListener('change', ()=> renderProducts(searchEl.value));
    document.getElementById('btn-view-cart').addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));

    // init
    renderCategories();
    renderProducts();
    renderCart();

    // expose for inline onclick
    window.addToCart = addToCart;
    window.updateQty = updateQty;
    window.removeFromCart = removeFromCart;
  </script>
</body>
</html>
